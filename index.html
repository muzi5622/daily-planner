<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Planner - Advanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        :root {
            --background: #121212;
            --widget-bg: linear-gradient(145deg, #1e1e1e, #2a2a2a);
            --text: #e0e0e0;
            --accent: linear-gradient(135deg, #4a9eff, #6a3093);
            --muted: #888;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
            --border: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--background);
            color: var(--text);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 15px;
            position: relative;
        }

        .header h1 {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            letter-spacing: 0.2em;
            margin-bottom: 10px;
            color: #fff;
            text-shadow: 0 0 10px rgba(74, 158, 255, 0.3);
        }

        .quote {
            font-style: italic;
            color: var(--muted);
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            cursor: pointer;
            transition: color 0.3s ease;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 10px;
        }

        .quote:hover {
            color: var(--text);
        }

        .quote.loading {
            opacity: 0.6;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .date-display {
            background: var(--accent);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3);
            font-size: clamp(0.8rem, 2vw, 1rem);
        }

        .return-today {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3);
            display: none;
            font-size: clamp(0.8rem, 2vw, 1rem);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .main-content {
                grid-template-columns: 300px 1fr;
                gap: 25px;
            }
        }

        @media (min-width: 1200px) {
            .main-content {
                grid-template-columns: 300px 1fr 300px;
                gap: 30px;
            }
        }

        .sidebar, .analytics-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (max-width: 767px) {
            .sidebar {
                order: 2;
            }
            
            .analytics-panel {
                order: 3;
            }
        }

        @media (max-width: 1199px) {
            .analytics-panel {
                display: none;
            }
        }

        .widget {
            background: var(--widget-bg);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        @media (min-width: 768px) {
            .widget {
                padding: 20px;
            }
        }

        .widget h3 {
            margin-bottom: 15px;
            color: #fff;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .calendar {
            text-align: center;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-nav {
            background: none;
            border: none;
            color: var(--muted);
            cursor: pointer;
            font-size: 1.2rem;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-nav:hover {
            color: #fff;
            background: rgba(74, 158, 255, 0.2);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
        }

        .calendar-day {
            padding: 6px;
            text-align: center;
            border-radius: 50%;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 2px auto;
            position: relative;
            font-size: 0.9rem;
        }

        @media (min-width: 768px) {
            .calendar-day {
                width: 35px;
                height: 35px;
                padding: 8px;
                font-size: 1rem;
            }
        }

        .calendar-day:hover {
            background: rgba(74, 158, 255, 0.2);
        }

        .calendar-day.today {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 10px rgba(74, 158, 255, 0.3);
        }

        .calendar-day.selected {
            background: rgba(74, 158, 255, 0.5);
            color: white;
            box-shadow: 0 4px 10px rgba(74, 158, 255, 0.3);
        }

        .calendar-day.has-data::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: #4a9eff;
            border-radius: 50%;
        }

        .calendar-day.other-month {
            color: #555;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 8px;
            background: rgba(51, 51, 51, 0.5);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .task-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #4a9eff;
            cursor: pointer;
            flex-shrink: 0;
        }

        .task-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .task-item span {
            flex: 1;
            word-break: break-word;
        }

        .add-task {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .add-task input {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            background: rgba(51, 51, 51, 0.5);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.95rem;
        }

        .add-task input:focus {
            outline: none;
            border-color: #4a9eff;
            box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.3);
        }

        .add-task button {
            padding: 10px 15px;
            background: var(--accent);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .add-task button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 158, 255, 0.3);
        }

        .notes-area {
            width: 100%;
            min-height: 120px;
            background: rgba(51, 51, 51, 0.5);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            color: var(--text);
            resize: vertical;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .notes-area:focus {
            outline: none;
            border-color: #4a9eff;
            box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.3);
        }

        .habit-tracker {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .habit-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(51, 51, 51, 0.5);
            border-radius: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .habit-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .habit-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #4a9eff;
            cursor: pointer;
            flex-shrink: 0;
        }

        .habit-item span {
            flex: 1;
            word-break: break-word;
        }

        .main-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .schedule-widget {
            background: var(--widget-bg);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        @media (min-width: 768px) {
            .schedule-widget {
                padding: 20px;
            }
        }

        .schedule-header {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .tab {
            background: none;
            border: none;
            color: var(--muted);
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
            font-size: clamp(0.8rem, 2vw, 1rem);
        }

        .tab:hover {
            color: #fff;
            background: rgba(74, 158, 255, 0.1);
        }

        .tab.active {
            color: #fff;
            background: var(--accent);
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3);
        }

        .schedule-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
            overflow-x: auto;
            display: block;
        }

        @media (min-width: 768px) {
            .schedule-table {
                display: table;
            }
        }

        .schedule-table thead,
        .schedule-table tbody,
        .schedule-table tr {
            display: block;
        }

        @media (min-width: 768px) {
            .schedule-table thead,
            .schedule-table tbody,
            .schedule-table tr {
                display: table-row-group;
            }
            
            .schedule-table tr {
                display: table-row;
            }
        }

        .schedule-table th,
        .schedule-table td {
            display: block;
            text-align: left;
            padding: 8px 10px;
            border-bottom: 1px solid #444;
        }

        @media (min-width: 768px) {
            .schedule-table th,
            .schedule-table td {
                display: table-cell;
                padding: 12px 15px;
                border-bottom: none;
            }
        }

        .schedule-table th {
            color: var(--muted);
            font-weight: 500;
            background: rgba(51, 51, 51, 0.3);
        }

        .schedule-table td {
            background: rgba(51, 51, 51, 0.5);
        }

        @media (min-width: 768px) {
            .schedule-table tr td:first-child {
                border-top-left-radius: 8px;
                border-bottom-left-radius: 8px;
            }

            .schedule-table tr td:last-child {
                border-top-right-radius: 8px;
                border-bottom-right-radius: 8px;
            }
        }

        .schedule-row {
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .schedule-row {
                margin-bottom: 0;
            }
            
            .schedule-row:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }
        }

        .time-cell {
            color: var(--muted);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .task-input {
            background: transparent;
            border: none;
            color: var(--text);
            width: 100%;
            padding: 5px;
            font-size: 0.95rem;
        }

        .task-input:focus {
            outline: none;
            background: rgba(74, 158, 255, 0.1);
            border-radius: 4px;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }

        .status-not-started {
            background: #555;
            color: #ccc;
        }

        .status-in-progress {
            background: var(--accent);
            color: white;
        }

        .status-done {
            background: var(--success);
            color: white;
        }

        .status-low {
            background: var(--success);
            color: white;
        }

        .status-medium {
            background: var(--warning);
            color: white;
        }

        .status-high {
            background: var(--error);
            color: white;
        }

        .custom-select {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        @media (min-width: 768px) {
            .custom-select {
                width: auto;
            }
        }

        .custom-select select {
            appearance: none;
            -webkit-appearance: none;
            background: rgba(51, 51, 51, 0.5);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 30px 8px 15px;
            color: var(--text);
            cursor: pointer;
            font-size: 0.9rem;
            width: 100%;
        }

        .custom-select select:focus {
            outline: none;
            border-color: #4a9eff;
            box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.3);
        }

        .custom-select::after {
            content: "‚ñº";
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            color: var(--muted);
            pointer-events: none;
            font-size: 0.8rem;
        }

        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: var(--muted);
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #4a9eff;
        }

        .empty-state p {
            font-size: 1rem;
            max-width: 400px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .delete-btn {
            background: var(--error);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: auto;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .delete-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .readonly-indicator {
            background: rgba(255, 152, 0, 0.2);
            color: var(--warning);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 10px;
            display: none;
        }

        .export-btn {
            background: var(--accent);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin: 5px;
            transition: all 0.2s;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 158, 255, 0.3);
        }

        .drop-zone {
            border: 2px dashed #4a9eff;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
            text-align: center;
            color: var(--muted);
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            background: rgba(74, 158, 255, 0.1);
            border-color: #6a9eff;
        }

        /* Mobile specific adjustments */
        @media (max-width: 767px) {
            .container {
                padding: 10px;
            }
            
            .header {
                margin-bottom: 15px;
                padding-bottom: 10px;
            }
            
            .header-controls {
                position: static;
                margin-top: 10px;
                justify-content: center;
            }
            
            .schedule-table th {
                display: none;
            }
            
            .schedule-table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
            }
            
            .schedule-table td::before {
                content: attr(data-label);
                font-weight: bold;
                color: var(--muted);
                margin-right: 10px;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DAILY PLANNER</h1>
            <div class="quote" id="motivationalQuote">"Today is your opportunity to build the tomorrow you want." ‚Äî Ken Poirot</div>
            <div class="header-controls">
                <div class="date-display" id="currentDateDisplay"></div>
                <button class="return-today" id="returnToday">Return to Today</button>
            </div>
        </div>

        <div class="main-content" id="mainContent">
            <div class="sidebar">
                <!-- Calendar Widget -->
                <div class="widget calendar">
                    <div class="calendar-header">
                        <button class="calendar-nav" onclick="changeMonth(-1)">‚Äπ</button>
                        <span id="currentMonth">May 2025</span>
                        <button class="calendar-nav" onclick="changeMonth(1)">‚Ä∫</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Priority Tasks -->
                <div class="widget">
                    <h3>Priority Tasks</h3>
                    <div class="readonly-indicator" id="priorityTasksReadonly">Viewing past data (read-only)</div>
                    <div id="priorityTasks">
                        <!-- Tasks will be loaded here -->
                    </div>
                    <div class="add-task" id="addPriorityTaskContainer">
                        <input type="text" id="newPriorityTask" placeholder="New Task">
                        <button onclick="addPriorityTask()">Add</button>
                    </div>
                </div>

                <!-- Notes -->
                <div class="widget">
                    <h3>üìù Notes</h3>
                    <div class="readonly-indicator" id="notesReadonly">Viewing past data (read-only)</div>
                    <textarea class="notes-area" id="dailyNotes" placeholder="Write your notes here..."></textarea>
                </div>

                <!-- Habit Tracker -->
                <div class="widget">
                    <h3>
                        Simple Habit Tracker
                        <button class="export-btn" onclick="showAddHabitForm()" style="font-size: 0.8rem; padding: 4px 8px;">+ Add</button>
                    </h3>
                    <div class="readonly-indicator" id="habitsReadonly">Viewing past data (read-only)</div>
                    <div class="habit-tracker" id="habitTracker">
                        <!-- Habits will be loaded here -->
                    </div>
                    <div class="add-task" id="addHabitContainer" style="display: none;">
                        <input type="text" id="newHabit" placeholder="New Habit">
                        <button onclick="addNewHabit()">Add</button>
                        <button onclick="hideAddHabitForm()" style="background: var(--error);">Cancel</button>
                    </div>
                </div>
            </div>

            <div class="main-panel">
                <!-- Daily Schedule -->
                <div class="schedule-widget">
                    <div class="schedule-header">
                        <button class="tab active" onclick="switchTab('schedule')">üìÖ Schedule</button>
                        <button class="tab" onclick="switchTab('tasks')">üìã Tasks</button>
                        <button class="tab" onclick="switchTab('export')">üíæ Data</button>
                    </div>

                    <div id="scheduleTab">
                        <h3>Daily Schedule</h3>
                        <div class="readonly-indicator" id="scheduleReadonly">Viewing past data (read-only)</div>
                        <table class="schedule-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Task</th>
                                    <th>Notes</th>
                                    <th>Done</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="scheduleBody">
                                <!-- Schedule rows will be generated here -->
                            </tbody>
                        </table>
                    </div>

                    <div id="tasksTab" style="display: none;">
                        <h3>Daily Tasks</h3>
                        <div class="readonly-indicator" id="tasksReadonly">Viewing past data (read-only)</div>
                        <div id="dailyTasksList">
                            <!-- Daily tasks will be loaded here -->
                        </div>
                        <div class="add-task" id="addDailyTaskContainer">
                            <input type="text" id="newDailyTask" placeholder="New Task">
                            <div class="custom-select">
                                <select id="taskPriority">
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <button onclick="addDailyTask()">Add Task</button>
                        </div>
                    </div>

                    <div id="exportTab" style="display: none;">
                        <h3>Data Management</h3>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
                            <button class="export-btn" onclick="exportData()">Export JSON</button>
                        </div>
                        
                        <div class="drop-zone" id="importZone">
                            <p>Drag and drop a JSON file here to import data</p>
                            <input type="file" id="importFile" accept=".json" style="display: none;">
                            <button class="export-btn" onclick="document.getElementById('importFile').click()">Choose File</button>
                        </div>

                        <div style="margin-top: 20px;">
                            <h4>Data Overview</h4>
                            <div id="dataStats" style="margin-top: 10px;">
                                <!-- Data statistics will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="analytics-panel">
                <!-- Quick Stats -->
                <div class="widget">
                    <h3>Quick Stats</h3>
                    <div id="quickStats">
                        <div style="margin-bottom: 10px;">
                            <span>Tasks Completed Today: </span>
                            <span id="tasksCompletedToday">0</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <span>Habits Completed: </span>
                            <span id="habitsCompletedToday">0</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <span>Productivity Score: </span>
                            <span id="productivityScore">0%</span>
                        </div>
                    </div>
                </div>

                <!-- Motivational Section -->
                <div class="widget">
                    <h3>Motivation</h3>
                    <button class="export-btn" onclick="fetchNewQuote()">New Quote</button>
                    <div style="margin-top: 10px;">
                        <p style="color: var(--muted); font-size: 0.9rem; margin-bottom: 10px;">Quotes refresh automatically every 2 minutes</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentDate = new Date();
        let selectedDate = new Date();
        let viewingToday = true;
        let currentTab = 'schedule';
        let quoteRefreshInterval = null;
        
        // Default time slots for schedule
        const defaultTimeSlots = [
            '05:00', '06:00', '07:00', '08:00', '09:00', '10:00', '11:00', '12:00',
            '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00'
        ];

        // Default habits
        const defaultHabits = [
            '7-8 Hrs of sleep',
            'Workout in morning',
            'Drink 8 glasses of water',
            'Read 20 pages'
        ];

        // Fallback quotes in case API fails
        const fallbackQuotes = [
            "Today is your opportunity to build the tomorrow you want. ‚Äî Ken Poirot",
            "The way to get started is to quit talking and begin doing. ‚Äî Walt Disney",
            "Don't let yesterday take up too much of today. ‚Äî Will Rogers",
            "You learn more from failure than from success. ‚Äî Unknown",
            "It's not whether you get knocked down, it's whether you get up. ‚Äî Vince Lombardi",
            "If you are working on something exciting that you really care about, you don't have to be pushed. ‚Äî Steve Jobs",
            "Success is not final, failure is not fatal: it is the courage to continue that counts. ‚Äî Winston Churchill",
            "The future depends on what you do today. ‚Äî Mahatma Gandhi",
            "Don't watch the clock; do what it does. Keep going. ‚Äî Sam Levenson",
            "Believe you can and you're halfway there. ‚Äî Theodore Roosevelt"
        ];

        // Initialize the app
        function init() {
            checkNewDay();
            updateDateDisplay();
            generateCalendar();
            loadPriorityTasks();
            loadHabits();
            loadDailyNotes();
            generateSchedule();
            loadDailyTasks();
            setupEventListeners();
            setupDragAndDrop();
            updateQuickStats();
            fetchNewQuote();
            startQuoteRefresh();
            updateDataStats();
        }

        // Quote API Functions
        async function fetchNewQuote() {
            const quoteElement = document.getElementById('motivationalQuote');
            quoteElement.classList.add('loading');
            
            try {
                const response = await fetch('https://api.quotable.io/random?tags=motivational,inspirational,success,wisdom');
                
                if (response.ok) {
                    const data = await response.json();
                    const quote = `"${data.content}" ‚Äî ${data.author}`;
                    quoteElement.textContent = quote;
                } else {
                    throw new Error('API request failed');
                }
            } catch (error) {
                console.log('Quote API failed, using fallback quote');
                const randomQuote = fallbackQuotes[Math.floor(Math.random() * fallbackQuotes.length)];
                quoteElement.textContent = randomQuote;
            } finally {
                quoteElement.classList.remove('loading');
            }
        }

        function startQuoteRefresh() {
            // Refresh quote every 2 minutes (120000 ms)
            quoteRefreshInterval = setInterval(fetchNewQuote, 120000);
        }

        function stopQuoteRefresh() {
            if (quoteRefreshInterval) {
                clearInterval(quoteRefreshInterval);
                quoteRefreshInterval = null;
            }
        }

        // Update date display
        function updateDateDisplay() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDateDisplay').textContent = selectedDate.toLocaleDateString('en-US', options);
            
            // Show/hide return to today button
            const returnButton = document.getElementById('returnToday');
            if (viewingToday) {
                returnButton.style.display = 'none';
            } else {
                returnButton.style.display = 'block';
            }
            
            // Show/hide readonly indicators
            const readonlyIndicators = document.querySelectorAll('.readonly-indicator');
            readonlyIndicators.forEach(indicator => {
                indicator.style.display = viewingToday ? 'none' : 'block';
            });
            
            // Enable/disable inputs based on whether viewing today
            toggleInputsReadonly(!viewingToday);
        }

        // Toggle inputs readonly state
        function toggleInputsReadonly(readonly) {
            // Priority task inputs
            document.getElementById('addPriorityTaskContainer').style.display = readonly ? 'none' : 'flex';
            
            // Notes textarea
            document.getElementById('dailyNotes').readOnly = readonly;
            
            // Daily task inputs
            document.getElementById('addDailyTaskContainer').style.display = readonly ? 'none' : 'flex';
            
            // Schedule inputs
            const scheduleInputs = document.querySelectorAll('.task-input');
            scheduleInputs.forEach(input => {
                input.readOnly = readonly;
            });
            
            // Checkboxes
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.disabled = readonly;
            });
            
            // Status selects
            const selects = document.querySelectorAll('select:not(#taskPriority)');
            selects.forEach(select => {
                select.disabled = readonly;
            });
        }

        // Check if it's a new day and reset if needed
        function checkNewDay() {
            const today = new Date().toDateString();
            const lastDate = localStorage.getItem('lastDate');
            
            if (lastDate && lastDate !== today) {
                // Save yesterday's data to history
                saveToHistory(lastDate);
                // Clear today's data
                clearTodayData();
            }
            
            localStorage.setItem('lastDate', today);
        }

        // Save completed items to history
        function saveToHistory(date) {
            const history = JSON.parse(localStorage.getItem('plannerHistory') || '{}');
            
            const dayData = {
                priorityTasks: JSON.parse(localStorage.getItem('priorityTasks') || '[]'),
                habits: JSON.parse(localStorage.getItem('habits') || '[]'),
                schedule: JSON.parse(localStorage.getItem('schedule') || '{}'),
                dailyTasks: JSON.parse(localStorage.getItem('dailyTasks') || '[]'),
                notes: localStorage.getItem('dailyNotes') || ''
            };
            
            // Only save if there's actual data
            if (dayData.priorityTasks.length > 0 || dayData.habits.length > 0 || 
                Object.keys(dayData.schedule).length > 0 || dayData.dailyTasks.length > 0 || dayData.notes) {
                history[date] = dayData;
                localStorage.setItem('plannerHistory', JSON.stringify(history));
            }
        }

        // Clear today's data for new day
        function clearTodayData() {
            localStorage.removeItem('priorityTasks');
            localStorage.removeItem('schedule');
            localStorage.removeItem('dailyTasks');
            localStorage.removeItem('dailyNotes');
            
            // Reset habits to default uncompleted state but keep custom habits
            const currentHabits = JSON.parse(localStorage.getItem('habits') || '[]');
            const resetHabits = currentHabits.map(habit => ({ ...habit, completed: false }));
            localStorage.setItem('habits', JSON.stringify(resetHabits));
        }

        // Generate calendar
        function generateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const today = new Date();
            
            document.getElementById('currentMonth').textContent = 
                currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            dayHeaders.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.textContent = day;
                dayElement.style.fontWeight = 'bold';
                dayElement.style.color = 'var(--muted)';
                calendarGrid.appendChild(dayElement);
            });
            
            // Get history data to mark days with data
            const history = JSON.parse(localStorage.getItem('plannerHistory') || '{}');
            
            // Add calendar days
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                const dateString = date.toDateString();
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = date.getDate();
                
                if (date.getMonth() !== month) {
                    dayElement.classList.add('other-month');
                }
                
                if (dateString === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                if (dateString === selectedDate.toDateString()) {
                    dayElement.classList.add('selected');
                }
                
                // Check if this date has data in history
                if (history[dateString]) {
                    dayElement.classList.add('has-data');
                }
                
                // Add click event to view data for this date
                dayElement.addEventListener('click', () => {
                    selectDate(date);
                });
                
                calendarGrid.appendChild(dayElement);
            }
        }

        // Select a date to view
        function selectDate(date) {
            selectedDate = new Date(date);
            viewingToday = selectedDate.toDateString() === new Date().toDateString();
            
            // Update UI
            updateDateDisplay();
            generateCalendar();
            
            // Load data for selected date
            if (viewingToday) {
                loadPriorityTasks();
                loadHabits();
                loadDailyNotes();
                generateSchedule();
                loadDailyTasks();
                updateQuickStats();
            } else {
                loadHistoryData(selectedDate.toDateString());
            }
        }

        // Load data from history for a specific date
        function loadHistoryData(dateString) {
            const history = JSON.parse(localStorage.getItem('plannerHistory') || '{}');
            const dayData = history[dateString];
            
            if (dayData) {
                // Load priority tasks
                displayPriorityTasks(dayData.priorityTasks || []);
                
                // Load habits
                displayHabits(dayData.habits || []);
                
                // Load notes
                document.getElementById('dailyNotes').value = dayData.notes || '';
                
                // Load schedule
                displaySchedule(dayData.schedule || {});
                
                // Load daily tasks
                displayDailyTasks(dayData.dailyTasks || []);
            } else {
                // No data for this date
                displayEmptyState();
            }
        }

        // Display empty state when no data is available
        function displayEmptyState() {
            // Clear all data displays
            document.getElementById('priorityTasks').innerHTML = '<div class="empty-state"><p>No priority tasks for this date.</p></div>';
            document.getElementById('habitTracker').innerHTML = '<div class="empty-state"><p>No habit data for this date.</p></div>';
            document.getElementById('dailyNotes').value = '';
            document.getElementById('scheduleBody').innerHTML = '<tr><td colspan="5"><div class="empty-state"><h3>No Data Available</h3><p>There is no planner data saved for this date.</p></div></td></tr>';
            document.getElementById('dailyTasksList').innerHTML = '<div class="empty-state"><p>No tasks for this date.</p></div>';
        }

        // Change month in calendar
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar();
        }

        // Return to today
        function returnToToday() {
            selectDate(new Date());
        }

        // Priority Tasks functions
        function loadPriorityTasks() {
            const tasks = JSON.parse(localStorage.getItem('priorityTasks') || '[]');
            displayPriorityTasks(tasks);
        }

        function displayPriorityTasks(tasks) {
            const container = document.getElementById('priorityTasks');
            container.innerHTML = '';
            
            if (tasks.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No priority tasks added yet.</p></div>';
                return;
            }
            
            tasks.forEach((task, index) => {
                const taskElement = document.createElement('div');
                taskElement.className = `task-item ${task.completed ? 'completed' : ''} fade-in`;
                taskElement.style.animationDelay = `${index * 0.05}s`;
                
                let deleteButton = '';
                if (viewingToday) {
                    deleteButton = `<button class="delete-btn" onclick="deletePriorityTask(${index})">√ó</button>`;
                }
                
                taskElement.innerHTML = `
                    <input type="checkbox" ${task.completed ? 'checked' : ''} 
                           onchange="togglePriorityTask(${index})" ${!viewingToday ? 'disabled' : ''}>
                    <span>${task.text}</span>
                    ${deleteButton}
                `;
                container.appendChild(taskElement);
            });
        }

        function addPriorityTask() {
            const input = document.getElementById('newPriorityTask');
            const text = input.value.trim();
            if (!text) return;
            
            const tasks = JSON.parse(localStorage.getItem('priorityTasks') || '[]');
            tasks.push({ text, completed: false });
            localStorage.setItem('priorityTasks', JSON.stringify(tasks));
            
            input.value = '';
            loadPriorityTasks();
            updateQuickStats();
        }

        function togglePriorityTask(index) {
            if (!viewingToday) return;
            
            const tasks = JSON.parse(localStorage.getItem('priorityTasks') || '[]');
            tasks[index].completed = !tasks[index].completed;
            localStorage.setItem('priorityTasks', JSON.stringify(tasks));
            loadPriorityTasks();
            updateQuickStats();
        }

        function deletePriorityTask(index) {
            if (!viewingToday) return;
            
            const tasks = JSON.parse(localStorage.getItem('priorityTasks') || '[]');
            tasks.splice(index, 1);
            localStorage.setItem('priorityTasks', JSON.stringify(tasks));
            loadPriorityTasks();
            updateQuickStats();
        }

        // Habits functions
        function loadHabits() {
            let habits = JSON.parse(localStorage.getItem('habits') || '[]');
            if (habits.length === 0) {
                habits = defaultHabits.map(habit => ({ text: habit, completed: false }));
                localStorage.setItem('habits', JSON.stringify(habits));
            }
            
            displayHabits(habits);
        }

        function displayHabits(habits) {
            const container = document.getElementById('habitTracker');
            container.innerHTML = '';
            
            habits.forEach((habit, index) => {
                const habitElement = document.createElement('div');
                habitElement.className = 'habit-item fade-in';
                habitElement.style.animationDelay = `${index * 0.05}s`;
                
                let deleteButton = '';
                if (viewingToday && !defaultHabits.includes(habit.text)) {
                    deleteButton = `<button class="delete-btn" onclick="deleteHabit(${index})">√ó</button>`;
                }
                
                habitElement.innerHTML = `
                    <input type="checkbox" ${habit.completed ? 'checked' : ''} 
                           onchange="toggleHabit(${index})" ${!viewingToday ? 'disabled' : ''}>
                    <span>${habit.text}</span>
                    ${deleteButton}
                `;
                container.appendChild(habitElement);
            });
        }

        function toggleHabit(index) {
            if (!viewingToday) return;
            
            const habits = JSON.parse(localStorage.getItem('habits') || '[]');
            habits[index].completed = !habits[index].completed;
            localStorage.setItem('habits', JSON.stringify(habits));
            loadHabits();
            updateQuickStats();
        }

        function showAddHabitForm() {
            if (!viewingToday) return;
            document.getElementById('addHabitContainer').style.display = 'flex';
        }

        function hideAddHabitForm() {
            document.getElementById('addHabitContainer').style.display = 'none';
            document.getElementById('newHabit').value = '';
        }

        function addNewHabit() {
            const input = document.getElementById('newHabit');
            const text = input.value.trim();
            if (!text) return;
            
            const habits = JSON.parse(localStorage.getItem('habits') || '[]');
            habits.push({ text, completed: false });
            localStorage.setItem('habits', JSON.stringify(habits));
            
            hideAddHabitForm();
            loadHabits();
            updateQuickStats();
        }

        function deleteHabit(index) {
            if (!viewingToday) return;
            
            const habits = JSON.parse(localStorage.getItem('habits') || '[]');
            habits.splice(index, 1);
            localStorage.setItem('habits', JSON.stringify(habits));
            loadHabits();
            updateQuickStats();
        }

        // Notes functions
        function loadDailyNotes() {
            const notes = localStorage.getItem('dailyNotes') || '';
            document.getElementById('dailyNotes').value = notes;
        }

        // Schedule functions
        function generateSchedule() {
            const schedule = JSON.parse(localStorage.getItem('schedule') || '{}');
            displaySchedule(schedule);
        }

        function displaySchedule(schedule) {
            const tbody = document.getElementById('scheduleBody');
            tbody.innerHTML = '';
            
            defaultTimeSlots.forEach((time, index) => {
                const row = document.createElement('tr');
                row.className = 'schedule-row fade-in';
                row.style.animationDelay = `${index * 0.03}s`;
                
                const taskData = schedule[time] || { task: '', notes: '', completed: false, status: 'not-started' };
                
                let statusDropdown = `
                    <div class="custom-select">
                        <select onchange="updateScheduleStatus('${time}', this.value)" ${!viewingToday ? 'disabled' : ''}>
                            <option value="not-started" ${taskData.status === 'not-started' ? 'selected' : ''}>Not started</option>
                            <option value="in-progress" ${taskData.status === 'in-progress' ? 'selected' : ''}>In progress</option>
                            <option value="done" ${taskData.status === 'done' ? 'selected' : ''}>Done</option>
                        </select>
                    </div>
                `;
                
                if (!viewingToday) {
                    // For past dates, show status badge instead of dropdown
                    let statusClass = '';
                    let statusText = '';
                    
                    switch(taskData.status) {
                        case 'in-progress':
                            statusClass = 'status-in-progress';
                            statusText = 'In progress';
                            break;
                        case 'done':
                            statusClass = 'status-done';
                            statusText = 'Done';
                            break;
                        default:
                            statusClass = 'status-not-started';
                            statusText = 'Not started';
                    }
                    
                    statusDropdown = `<span class="status-badge ${statusClass}">${statusText}</span>`;
                }
                
                row.innerHTML = `
                    <td class="time-cell" data-label="Time">${time}</td>
                    <td class="task-cell" data-label="Task">
                        <input type="text" class="task-input" value="${taskData.task}" 
                               onchange="updateScheduleTask('${time}', this.value)" ${!viewingToday ? 'readonly' : ''} placeholder="Enter task">
                    </td>
                    <td data-label="Notes">
                        <input type="text" class="task-input" value="${taskData.notes}" 
                               onchange="updateScheduleNotes('${time}', this.value)" ${!viewingToday ? 'readonly' : ''} placeholder="Enter notes">
                    </td>
                    <td data-label="Done">
                        <input type="checkbox" ${taskData.completed ? 'checked' : ''} 
                               onchange="toggleScheduleTask('${time}')" ${!viewingToday ? 'disabled' : ''}>
                    </td>
                    <td data-label="Status">
                        ${statusDropdown}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateScheduleTask(time, task) {
            if (!viewingToday) return;
            
            const schedule = JSON.parse(localStorage.getItem('schedule') || '{}');
            if (!schedule[time]) schedule[time] = { task: '', notes: '', completed: false, status: 'not-started' };
            schedule[time].task = task;
            localStorage.setItem('schedule', JSON.stringify(schedule));
        }

        function updateScheduleNotes(time, notes) {
            if (!viewingToday) return;
            
            const schedule = JSON.parse(localStorage.getItem('schedule') || '{}');
            if (!schedule[time]) schedule[time] = { task: '', notes: '', completed: false, status: 'not-started' };
            schedule[time].notes = notes;
            localStorage.setItem('schedule', JSON.stringify(schedule));
        }

        function toggleScheduleTask(time) {
            if (!viewingToday) return;
            
            const schedule = JSON.parse(localStorage.getItem('schedule') || '{}');
            if (!schedule[time]) schedule[time] = { task: '', notes: '', completed: false, status: 'not-started' };
            schedule[time].completed = !schedule[time].completed;
            if (schedule[time].completed) {
                schedule[time].status = 'done';
            }
            localStorage.setItem('schedule', JSON.stringify(schedule));
            generateSchedule();
            updateQuickStats();
        }

        function updateScheduleStatus(time, status) {
            if (!viewingToday) return;
            
            const schedule = JSON.parse(localStorage.getItem('schedule') || '{}');
            if (!schedule[time]) schedule[time] = { task: '', notes: '', completed: false, status: 'not-started' };
            schedule[time].status = status;
            if (status === 'done') {
                schedule[time].completed = true;
            }
            localStorage.setItem('schedule', JSON.stringify(schedule));
            generateSchedule();
        }

        // Daily Tasks functions
        function loadDailyTasks() {
            const tasks = JSON.parse(localStorage.getItem('dailyTasks') || '[]');
            displayDailyTasks(tasks);
        }

        function displayDailyTasks(tasks) {
            const container = document.getElementById('dailyTasksList');
            container.innerHTML = '';
            
            if (tasks.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No daily tasks added yet.</p></div>';
                return;
            }
            
            tasks.forEach((task, index) => {
                const taskElement = document.createElement('div');
                taskElement.className = `task-item ${task.completed ? 'completed' : ''} fade-in`;
                taskElement.style.animationDelay = `${index * 0.05}s`;
                
                let deleteButton = '';
                if (viewingToday) {
                    deleteButton = `<button class="delete-btn" onclick="deleteDailyTask(${index})">√ó</button>`;
                }
                
                taskElement.innerHTML = `
                    <input type="checkbox" ${task.completed ? 'checked' : ''} 
                           onchange="toggleDailyTask(${index})" ${!viewingToday ? 'disabled' : ''}>
                    <span>${task.text}</span>
                    <span class="status-badge status-${task.priority}">${task.priority}</span>
                    ${deleteButton}
                `;
                container.appendChild(taskElement);
            });
        }

        function addDailyTask() {
            const input = document.getElementById('newDailyTask');
            const priority = document.getElementById('taskPriority').value;
            const text = input.value.trim();
            if (!text) return;
            
            const tasks = JSON.parse(localStorage.getItem('dailyTasks') || '[]');
            tasks.push({ text, priority, completed: false });
            localStorage.setItem('dailyTasks', JSON.stringify(tasks));
            
            input.value = '';
            loadDailyTasks();
            updateQuickStats();
        }

        function toggleDailyTask(index) {
            if (!viewingToday) return;
            
            const tasks = JSON.parse(localStorage.getItem('dailyTasks') || '[]');
            tasks[index].completed = !tasks[index].completed;
            localStorage.setItem('dailyTasks', JSON.stringify(tasks));
            loadDailyTasks();
            updateQuickStats();
        }

        function deleteDailyTask(index) {
            if (!viewingToday) return;
            
            const tasks = JSON.parse(localStorage.getItem('dailyTasks') || '[]');
            tasks.splice(index, 1);
            localStorage.setItem('dailyTasks', JSON.stringify(tasks));
            loadDailyTasks();
            updateQuickStats();
        }

        // Tab switching
        function switchTab(tab) {
            // Hide all tabs
            document.getElementById('scheduleTab').style.display = 'none';
            document.getElementById('tasksTab').style.display = 'none';
            document.getElementById('exportTab').style.display = 'none';
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tab + 'Tab').style.display = 'block';
            event.target.classList.add('active');
            
            currentTab = tab;
            
            if (tab === 'export') {
                updateDataStats();
            }
        }

        // Quick Stats Functions
        function updateQuickStats() {
            if (!viewingToday) return;
            
            const priorityTasks = JSON.parse(localStorage.getItem('priorityTasks') || '[]');
            const dailyTasks = JSON.parse(localStorage.getItem('dailyTasks') || '[]');
            const habits = JSON.parse(localStorage.getItem('habits') || '[]');
            
            const completedTasks = priorityTasks.filter(t => t.completed).length + 
                                 dailyTasks.filter(t => t.completed).length;
            const completedHabits = habits.filter(h => h.completed).length;
            
            // Calculate productivity score
            const totalTasks = priorityTasks.length + dailyTasks.length;
            const totalHabits = habits.length;
            let score = 0;
            
            if (totalTasks > 0) {
                score = Math.round(((completedTasks / totalTasks) * 0.7 + (completedHabits / totalHabits) * 0.3) * 100);
            } else if (totalHabits > 0) {
                score = Math.round((completedHabits / totalHabits) * 100);
            }
            
            document.getElementById('tasksCompletedToday').textContent = completedTasks;
            document.getElementById('habitsCompletedToday').textContent = `${completedHabits}/${habits.length}`;
            document.getElementById('productivityScore').textContent = `${score}%`;
        }

        // Data Export/Import Functions
        function exportData() {
            const data = {
                priorityTasks: JSON.parse(localStorage.getItem('priorityTasks') || '[]'),
                habits: JSON.parse(localStorage.getItem('habits') || '[]'),
                schedule: JSON.parse(localStorage.getItem('schedule') || '{}'),
                dailyTasks: JSON.parse(localStorage.getItem('dailyTasks') || '[]'),
                notes: localStorage.getItem('dailyNotes') || '',
                history: JSON.parse(localStorage.getItem('plannerHistory') || '{}'),
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `daily-planner-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function updateDataStats() {
            const container = document.getElementById('dataStats');
            const history = JSON.parse(localStorage.getItem('plannerHistory') || '{}');
            
            const totalDays = Object.keys(history).length + (viewingToday ? 1 : 0);
            const totalTasks = Object.values(history).reduce((sum, day) => {
                return sum + (day.priorityTasks?.length || 0) + (day.dailyTasks?.length || 0);
            }, 0) + (viewingToday ? JSON.parse(localStorage.getItem('priorityTasks') || '[]').length + JSON.parse(localStorage.getItem('dailyTasks') || '[]').length : 0);
            
            const totalHabits = JSON.parse(localStorage.getItem('habits') || '[]').length;
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 15px; background: rgba(74, 158, 255, 0.1); border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #4a9eff;">${totalDays}</div>
                        <div style="color: var(--muted);">Days Tracked</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #4caf50;">${totalTasks}</div>
                        <div style="color: var(--muted);">Total Tasks</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 152, 0, 0.1); border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #ff9800;">${totalHabits}</div>
                        <div style="color: var(--muted);">Active Habits</div>
                    </div>
                </div>
            `;
        }

        // Drag and Drop Functions
        function setupDragAndDrop() {
            // File import drag and drop
            const importZone = document.getElementById('importZone');
            
            importZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                importZone.classList.add('drag-over');
            });
            
            importZone.addEventListener('dragleave', (e) => {
                if (!importZone.contains(e.relatedTarget)) {
                    importZone.classList.remove('drag-over');
                }
            });
            
            importZone.addEventListener('drop', (e) => {
                e.preventDefault();
                importZone.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === 'application/json') {
                    importData(files[0]);
                }
            });
        }

        function importData(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('This will replace all your current data. Are you sure you want to continue?')) {
                        // Import all data
                        if (data.priorityTasks) localStorage.setItem('priorityTasks', JSON.stringify(data.priorityTasks));
                        if (data.habits) localStorage.setItem('habits', JSON.stringify(data.habits));
                        if (data.schedule) localStorage.setItem('schedule', JSON.stringify(data.schedule));
                        if (data.dailyTasks) localStorage.setItem('dailyTasks', JSON.stringify(data.dailyTasks));
                        if (data.notes) localStorage.setItem('dailyNotes', data.notes);
                        if (data.history) localStorage.setItem('plannerHistory', JSON.stringify(data.history));
                        
                        // Reload the page to reflect changes
                        location.reload();
                    }
                } catch (error) {
                    alert('Error importing data. Please check the file format.');
                }
            };
            reader.readAsText(file);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Auto-save notes
            const notesArea = document.getElementById('dailyNotes');
            if (notesArea) {
                notesArea.addEventListener('input', function() {
                    if (viewingToday) {
                        localStorage.setItem('dailyNotes', this.value);
                    }
                });
            }
            
            // Enter key handlers
            document.getElementById('newPriorityTask').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addPriorityTask();
            });
            
            document.getElementById('newDailyTask').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addDailyTask();
            });
            
            document.getElementById('newHabit').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addNewHabit();
            });
            
            // Header controls
            document.getElementById('returnToday').addEventListener('click', returnToToday);
            
            // Quote click handler
            document.getElementById('motivationalQuote').addEventListener('click', fetchNewQuote);
            
            // File import
            document.getElementById('importFile').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    importData(e.target.files[0]);
                }
            });
            
            // Page visibility change - pause quote refresh when tab is not active
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    stopQuoteRefresh();
                } else {
                    startQuoteRefresh();
                }
            });
        }

        // Check for new day every minute
        setInterval(checkNewDay, 60000);
        
        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', init);
        
        // Cleanup when page unloads
        window.addEventListener('beforeunload', function() {
            stopQuoteRefresh();
        });
    </script>
    <!-- 100% privacy-first analytics -->
    <script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>

</body>
</html>
